<article
  class="w-full min-h-[80vh] text-black flex flex-col items-center justify-start p-3 md:px-6 py-6 md:py-12"
>
  <div
    class="flex flex-col md:flex-row justify-between items-start md:items-center w-full gap-4 mb-6"
  >
    <app-page-header
      title="Pel√≠cula Aleatoria"
      subtitle="Descubre una pel√≠cula al azar para que la puedas ver con tus amigos"
    ></app-page-header>
    <div class="flex items-center justify-center w-full">
      <button
        mat-fab
        extended
        color="primary"
        (click)="loadRandomMovie()"
        [disabled]="loading()"
        class="!bg-[#9811fb] !text-white hover:!bg-[#7d0fd1] transition-all"
      >
        <mat-icon>shuffle</mat-icon>
        <span class="ml-2">Otra pel√≠cula</span>
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="flex flex-col items-center justify-center gap-2 text-gray-600 flex-1 min-h-[50vh]">
      <app-loader></app-loader>
      <span class="text-gray-500 mt-4">Buscando pel√≠cula aleatoria...</span>
    </div>
  } @else if (movie()) {
    <div
      class="w-full max-w-4xl bg-[#F0F4F9] rounded-2xl shadow-2xl border border-[#9811fb]/20 overflow-hidden animate-fade-in"
    >
      <div class="flex flex-col md:flex-row">
        <!-- Poster -->
        <div
          class="w-full md:w-2/5 relative bg-cover bg-center bg-no-repeat"
          style="background-image: url('assets/images/default-movie.png')"
        >
          <img
            [src]="getMoviePoster(movie()?.posterPath)"
            [alt]="movie()?.title"
            (error)="onImageError($event)"
            class="w-full h-full min-h-[300px] md:min-h-[500px] object-cover"
          />
          <!-- Score Badge -->
          <div
            class="absolute top-4 right-4 bg-[#9811fb] text-white px-4 py-2 rounded-full font-bold text-lg shadow-lg flex items-center gap-2"
          >
            <mat-icon class="text-yellow-300" style="font-size: 20px; width: 20px; height: 20px"
              >star</mat-icon
            >
            {{ movie()?.score || 0 }} pts
          </div>
        </div>

        <!-- Content -->
        <div class="w-full md:w-3/5 p-6 md:p-8 flex flex-col">
          <h2 class="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
            {{ movie()?.title }}
          </h2>

          <div class="flex flex-wrap gap-2 mb-4">
            @if (movie()?.director) {
              <span class="px-3 py-1 text-sm bg-gray-200 rounded-full text-gray-700 font-medium">
                üé¨ {{ movie()?.director }}
              </span>
            }
            @if (movie()?.releaseDate) {
              <span class="px-3 py-1 text-sm bg-gray-200 rounded-full text-gray-700 font-medium">
                üìÖ {{ movie()?.releaseDate | date: 'yyyy' }}
              </span>
            }
            @if (movie()?.runtime) {
              <span class="px-3 py-1 text-sm bg-gray-200 rounded-full text-gray-700 font-medium">
                ‚è±Ô∏è {{ formatRuntime(movie()?.runtime) }}
              </span>
            }
            @if (movie()?.originalLanguage) {
              <span
                class="px-3 py-1 text-sm bg-gray-200 rounded-full text-gray-700 font-medium uppercase"
              >
                üåç {{ movie()?.originalLanguage }}
              </span>
            }
          </div>

          @if (movie()?.genres) {
            <div class="flex flex-wrap gap-2 mb-4">
              @for (genre of parseGenres(movie()?.genres); track genre) {
                <span class="px-3 py-1 text-sm bg-[#9811fb] text-white rounded-full font-medium">
                  {{ genre }}
                </span>
              }
            </div>
          }

          <p class="text-gray-700 text-base leading-relaxed mb-4 flex-1">
            {{ getDisplayedOverview() || 'Sin descripci√≥n disponible.' }}
            @if ((movie()?.overview?.length || 0) > 300) {
              <button
                class="text-[#9811fb] font-semibold hover:underline ml-1"
                (click)="toggleOverview()"
              >
                {{ expandedOverview() ? 'Ver menos' : 'Ver m√°s' }}
              </button>
            }
          </p>

          <!-- Voting Info -->
          <div
            class="flex justify-between items-center gap-4 pt-4 border-t border-gray-300 mt-auto"
          >
            <div class="flex items-center gap-4">
              <div class="flex items-center gap-1 text-green-600">
                <mat-icon style="font-size: 24px; width: 24px; height: 24px">thumb_up</mat-icon>
                <span class="font-bold text-lg">{{ movie()?.upVotes || 0 }}</span>
              </div>
              <div class="flex items-center gap-1 text-red-600">
                <mat-icon style="font-size: 24px; width: 24px; height: 24px">thumb_down</mat-icon>
                <span class="font-bold text-lg">{{ movie()?.downVotes || 0 }}</span>
              </div>
            </div>
            <!-- <div class="text-gray-500 text-sm">ID: {{ movie()?.externalId }}</div> -->
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="flex flex-col items-center justify-center gap-4 text-gray-600 flex-1 min-h-[50vh]">
      <mat-icon style="font-size: 64px; width: 64px; height: 64px; color: #9811fb"
        >movie_filter</mat-icon
      >
      <p class="text-lg text-center">No se pudo cargar la pel√≠cula. Intenta de nuevo.</p>
      <button
        mat-fab
        extended
        color="primary"
        (click)="loadRandomMovie()"
        class="!bg-[#9811fb] !text-white hover:!bg-[#7d0fd1]"
      >
        <mat-icon>refresh</mat-icon>
        <span class="ml-2">Reintentar</span>
      </button>
    </div>
  }
</article>
