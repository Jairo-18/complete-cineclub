<app-auth-card
  [title]="'Cambiar Contraseña'"
  [subtitle]="'Establece una contraseña segura para tu cuenta.'"
  [showIcons]="false"
>
  <form [formGroup]="form" (ngSubmit)="changePassword()" class="flex flex-col gap-4 w-full py-4">
    <!-- Contraseña actual -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Contraseña Actual</mat-label>
      <input
        matInput
        [type]="hideCurrentPassword ? 'password' : 'text'"
        formControlName="currentPassword"
        placeholder="Tu contraseña actual"
      />
      <button mat-icon-button matSuffix type="button" (click)="toggleCurrentPasswordVisibility()">
        <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (
        form.get('currentPassword')?.hasError('required') && form.get('currentPassword')?.touched
      ) {
        <mat-error>La contraseña actual es requerida</mat-error>
      }
    </mat-form-field>

    <!-- Nueva contraseña -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Nueva Contraseña</mat-label>
      <input
        matInput
        [type]="hideNewPassword ? 'password' : 'text'"
        formControlName="newPassword"
        placeholder="Mínimo 6 caracteres"
      />
      <button mat-icon-button matSuffix type="button" (click)="toggleNewPasswordVisibility()">
        <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (form.get('newPassword')?.hasError('required') && form.get('newPassword')?.touched) {
        <mat-error>La nueva contraseña es requerida</mat-error>
      }
      @if (form.get('newPassword')?.hasError('passwordStrength')) {
        <mat-error>
          La contraseña debe tener 6 caracteres, con mayúscula, minúscula y un carácter especial.
        </mat-error>
      }
    </mat-form-field>

    <!-- Confirmar nueva contraseña -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Confirmar Nueva Contraseña</mat-label>
      <input
        matInput
        [type]="hideConfirmPassword ? 'password' : 'text'"
        formControlName="confirmPassword"
        placeholder="Repite tu nueva contraseña"
      />
      <button mat-icon-button matSuffix type="button" (click)="toggleConfirmPasswordVisibility()">
        <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (
        form.get('confirmPassword')?.hasError('required') && form.get('confirmPassword')?.touched
      ) {
        <mat-error>Confirma tu nueva contraseña</mat-error>
      }
      @if (form.hasError('passwordMismatch')) {
        <mat-error>Las contraseñas no coinciden</mat-error>
      }
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      type="submit"
      class="w-full mt-2"
      [disabled]="isLoading || form.invalid"
    >
      @if (isLoading) {
        <span>Cambiando...</span>
      } @else {
        <span>Cambiar Contraseña</span>
      }
    </button>
  </form>
</app-auth-card>
