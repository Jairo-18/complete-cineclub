import './polyfills.server.mjs';
import{b as Ee}from"./chunk-7ZPJTXPL.mjs";import{a as ge}from"./chunk-XXL64ETW.mjs";import{a as H,b as B,c as z,d as W}from"./chunk-CPUCP4NP.mjs";import{a as G}from"./chunk-HOIKXKDC.mjs";import{d as Se}from"./chunk-LYFFEPC2.mjs";import{a as ue,b as _e}from"./chunk-IZYF7JLB.mjs";import{b as Ie,c as ke}from"./chunk-DMVK7NGP.mjs";import{A as we,D as be,E as ye,e as fe,j as ve,n as Ce,u as xe,w as he}from"./chunk-R2LPZPTP.mjs";import{l as A,m as de,n as ce,o as D}from"./chunk-37XX4R2Q.mjs";import{b as j,c as N}from"./chunk-QHGSIMU3.mjs";import{a as pe}from"./chunk-TPI6FTCS.mjs";import{$b as F,Db as h,Gb as c,Ha as U,Ib as d,La as l,Sb as k,Ub as M,Uc as se,V as I,Vc as le,Wb as s,Xa as V,Xb as C,Yb as S,Zb as oe,Zc as me,_ as x,_b as L,_c as O,ab as ae,ac as $,cb as P,da as p,ea as u,f as re,ic as ee,kc as te,kd as E,nb as f,nd as R,o as y,ob as v,rb as X,sb as Z,tb as w,ub as n,ud as _,vb as o,wb as T}from"./chunk-I37AKPGM.mjs";import{a as ie,b as ne,h as Q}from"./chunk-S6KH3LOX.mjs";var Re=class a{_httpClient=x(R);_httpUtilities=x(G);reviewsChangedSubject=new re;reviewsChanged$=this.reviewsChangedSubject.asObservable();notifyReviewsChanged(){this.reviewsChangedSubject.next()}get headers(){let t=localStorage.getItem("access_token"),e=new E({"Content-Type":"application/json"});return t&&(e=e.set("Authorization",`Bearer ${t}`)),e}createReview(t){return this._httpClient.post(`${_.backendUrl}reviews`,t,{headers:this.headers})}getReviews(){return this._httpClient.get(`${_.backendUrl}reviews`,{headers:this.headers})}getReviewsWithPagination(t){let e=this._httpUtilities.httpParamsFromObject(t);return this._httpClient.get(`${_.backendUrl}reviews`,{params:e,headers:this.headers}).pipe(y(i=>({data:i.data,pagination:{page:i.page,size:i.size,total:i.total,totalPages:i.totalPages,hasNext:i.hasNext,hasPrevious:i.hasPrevious}})))}getReviewsByMovie(t){return this._httpClient.get(`${_.backendUrl}reviews/movie/${t}`,{headers:this.headers})}getReviewById(t){return this._httpClient.get(`${_.backendUrl}reviews/${t}`,{headers:this.headers})}updateReview(t,e){return this._httpClient.patch(`${_.backendUrl}reviews/${t}`,e,{headers:this.headers})}deleteReview(t){return this._httpClient.delete(`${_.backendUrl}reviews/${t}`,{headers:this.headers})}getUserReviewsWithPagination(t){let e=this._httpUtilities.httpParamsFromObject(t);return this._httpClient.get(`${_.backendUrl}reviews/user`,{params:e,headers:this.headers}).pipe(y(i=>({data:i.data,pagination:{page:i.page,size:i.size,total:i.total,totalPages:i.totalPages,hasNext:i.hasNext,hasPrevious:i.hasPrevious}})))}getUserReviewsByIdWithPagination(t,e){let i=this._httpUtilities.httpParamsFromObject(ne(ie({},e),{userId:t}));return this._httpClient.get(`${_.backendUrl}reviews`,{params:i,headers:this.headers}).pipe(y(r=>({data:r.data,pagination:{page:r.page,size:r.size,total:r.total,totalPages:r.totalPages,hasNext:r.hasNext,hasPrevious:r.hasPrevious}})))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"})};var J=class a{_httpClient=x(R);get headers(){let t=localStorage.getItem("access_token"),e=new E({"Content-Type":"application/json"});return t&&(e=e.set("Authorization",`Bearer ${t}`)),e}likeReview(t){return this._httpClient.post(`${_.backendUrl}reviews/like/${t}`,{},{headers:this.headers})}dislikeReview(t){return this._httpClient.delete(`${_.backendUrl}reviews/like/${t}`,{headers:this.headers})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"})};var Y=class a{_httpClient=x(R);_httpUtilities=x(G);get headers(){let t=localStorage.getItem("access_token"),e=new E({"Content-Type":"application/json"});return t&&(e=e.set("Authorization",`Bearer ${t}`)),e}getCommentsByReview(t,e){let i=this._httpUtilities.httpParamsFromObject(e);return this._httpClient.get(`${_.backendUrl}comments/${t}`,{params:i,headers:this.headers})}createComment(t){return this._httpClient.post(`${_.backendUrl}comments`,t,{headers:this.headers}).pipe(y(e=>e.data))}replyToComment(t,e){return this._httpClient.post(`${_.backendUrl}comments/reply/${t}`,e,{headers:this.headers}).pipe(y(i=>i.data))}likeComment(t){return this._httpClient.post(`${_.backendUrl}comments/like/${t}`,{},{headers:this.headers})}dislikeComment(t){return this._httpClient.delete(`${_.backendUrl}comments/like/${t}`,{headers:this.headers})}updateComment(t,e){return this._httpClient.patch(`${_.backendUrl}comments/${t}`,e,{headers:this.headers}).pipe(y(i=>i.data))}deleteComment(t){return this._httpClient.delete(`${_.backendUrl}comments/${t}`,{headers:this.headers})}deleteReply(t){return this._httpClient.delete(`${_.backendUrl}comments/reply/${t}`,{headers:this.headers})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"})};var Ue=(a,t)=>t.id;function Oe(a,t){a&1&&(n(0,"div",7),T(1,"mat-spinner",11),o())}function je(a,t){if(a&1){let e=h();n(0,"button",26)(1,"mat-icon"),s(2,"more_vert"),o()(),n(3,"mat-menu",27,0)(5,"button",28),c("click",function(){p(e);let r=d().$implicit,m=d();return u(m.startEdit(r))}),n(6,"mat-icon"),s(7,"edit"),o(),n(8,"span"),s(9,"Editar"),o()(),n(10,"button",29),c("click",function(){p(e);let r=d().$implicit,m=d();return u(m.deleteComment(r))}),n(11,"mat-icon",30),s(12,"delete"),o(),n(13,"span"),s(14,"Eliminar"),o()()()}if(a&2){let e=k(4);w("matMenuTriggerFor",e)}}function Ne(a,t){if(a&1){let e=h();n(0,"div",18)(1,"mat-form-field",4)(2,"input",31),$("ngModelChange",function(r){p(e);let m=d(2);return F(m.editContent,r)||(m.editContent=r),u(r)}),c("keyup.enter",function(){p(e);let r=d().$implicit,m=d();return u(m.saveEdit(r))}),o()(),n(3,"div",32)(4,"button",33),c("click",function(){p(e);let r=d(2);return u(r.cancelEdit())}),s(5,"Cancelar"),o(),n(6,"button",34),c("click",function(){p(e);let r=d().$implicit,m=d();return u(m.saveEdit(r))}),s(7," Guardar "),o()()()}if(a&2){let e=d(2);l(2),L("ngModel",e.editContent)}}function Ae(a,t){if(a&1&&(n(0,"p",19),s(1),o()),a&2){let e=d().$implicit;l(),C(e.content)}}function De(a,t){if(a&1){let e=h();n(0,"div",24)(1,"mat-form-field",35)(2,"input",36),$("ngModelChange",function(r){p(e);let m=d(2);return F(m.replyContent,r)||(m.replyContent=r),u(r)}),c("keyup.enter",function(){p(e);let r=d().$implicit,m=d();return u(m.sendReply(r.id))}),o(),n(3,"button",6),c("click",function(){p(e);let r=d().$implicit,m=d();return u(m.sendReply(r.id))}),n(4,"mat-icon"),s(5,"send"),o()()()()}if(a&2){let e=d(2);l(2),L("ngModel",e.replyContent),l(),w("disabled",!e.replyContent.trim())}}function He(a,t){if(a&1){let e=h();n(0,"button",26)(1,"mat-icon",22),s(2,"more_vert"),o()(),n(3,"mat-menu",27,1)(5,"button",29),c("click",function(){p(e);let r=d().$implicit,m=d(4);return u(m.deleteComment(r))}),n(6,"mat-icon",30),s(7,"delete"),o(),n(8,"span"),s(9,"Eliminar"),o()()()}if(a&2){let e=k(4);w("matMenuTriggerFor",e)}}function Be(a,t){if(a&1){let e=h();n(0,"div",12)(1,"img",40),c("error",function(){let r=p(e).$implicit;return u(r.avatarUrl="/assets/images/defaultUser.png")}),o(),n(2,"div",14)(3,"div",41)(4,"div",16)(5,"span",42),s(6),o(),f(7,He,10,1),o(),n(8,"p",43),s(9),o()(),n(10,"div",44)(11,"button",21),c("click",function(){let r=p(e).$implicit,m=d(4);return u(m.toggleLike(r))}),n(12,"mat-icon",22),s(13),o(),n(14,"span"),s(15),o()(),n(16,"span"),s(17),ee(18,"date"),o()()()()}if(a&2){let e=t.$implicit,i=d(4);l(),w("src",e.avatarUrl||"/assets/images/defaultUser.png",U),l(5),C(e.userName),l(),v(i.isOwner(e)?7:-1),l(2),C(e.content),l(2),M("text-red-500",e.liked),l(2),C(e.liked?"favorite":"favorite_border"),l(2),C(e.likes),l(2),C(te(18,9,e.createdAt,"shortDate"))}}function ze(a,t){if(a&1&&X(0,Be,19,12,"div",12,Ue),a&2){let e=d(2).$implicit;Z(e.replies)}}function We(a,t){if(a&1){let e=h();n(0,"div",25)(1,"button",37),c("click",function(){p(e);let r=d().$implicit,m=d();return u(m.toggleRepliesVisibility(r.id))}),n(2,"div",38)(3,"mat-icon",39),s(4),o(),n(5,"span"),s(6),o()()(),f(7,ze,2,0),o()}if(a&2){let e=d().$implicit,i=d();l(4),C(i.replyVisibility[e.id]?"expand_less":"expand_more"),l(2),S(" ",i.replyVisibility[e.id]?"Ocultar respuestas":"Ver "+e.replies.length+" respuestas"," "),l(),v(i.replyVisibility[e.id]?7:-1)}}function Ge(a,t){if(a&1){let e=h();n(0,"div",9)(1,"div",12)(2,"img",13),c("error",function(){let r=p(e).$implicit;return u(r.avatarUrl="/assets/images/defaultUser.png")}),o(),n(3,"div",14)(4,"div",15)(5,"div",16)(6,"span",17),s(7),o(),f(8,je,15,1),o(),f(9,Ne,8,1,"div",18)(10,Ae,2,1,"p",19),o(),n(11,"div",20)(12,"button",21),c("click",function(){let r=p(e).$implicit,m=d();return u(m.toggleLike(r))}),n(13,"mat-icon",22),s(14),o(),n(15,"span"),s(16),o()(),n(17,"button",23),c("click",function(){let r=p(e).$implicit,m=d();return u(m.toggleReply(r.id))}),s(18," Responder "),o(),n(19,"span"),s(20),ee(21,"date"),o()(),f(22,De,6,2,"div",24),o()(),f(23,We,8,3,"div",25),o()}if(a&2){let e=t.$implicit,i=d();l(2),w("src",e.avatarUrl||"/assets/images/defaultUser.png",U),l(5),C(e.userName),l(),v(i.isOwner(e)?8:-1),l(),v(i.editingCommentId===e.id?9:10),l(3),M("text-red-500",e.liked),l(2),C(e.liked?"favorite":"favorite_border"),l(2),C(e.likes),l(4),C(te(21,11,e.createdAt,"shortDate")),l(2),v(i.replyingToId===e.id?22:-1),l(),v(e.replies&&e.replies.length>0?23:-1)}}function qe(a,t){if(a&1){let e=h();n(0,"div",10)(1,"button",45),c("click",function(){p(e);let r=d();return u(r.loadMoreComments())}),s(2," Ver m\xE1s comentarios "),o()()}}function Je(a,t){a&1&&(n(0,"div",7),T(1,"mat-spinner",11),o())}var K=class a{_commentsService=x(Y);reviewId;currentUserId="";comments=[];isLoading=!1;newCommentContent="";replyContent="";replyingToId=null;editingCommentId=null;editContent="";currentUserName="";currentUserAvatar="/assets/images/defaultUser.png";replyVisibility={};_userService=x(ge);ngOnInit(){this.getCurrentUser(),this.loadComments()}getCurrentUser(){let t=localStorage.getItem("app_session");if(t)try{let e=JSON.parse(t);this.currentUserId=e.user?.id||"",this.currentUserId&&this._userService.getUserById(this.currentUserId).subscribe({next:i=>Q(this,null,function*(){this.currentUserName=i.fullName||i.username||"Usuario";let{data:r}=yield this._supabaseClient.from("profile").select("avatarUrl").eq("id",this.currentUserId).maybeSingle();r&&(this.currentUserAvatar=r.avatarUrl||"/assets/images/defaultUser.png")}),error:()=>{this.currentUserName="Usuario"}})}catch(e){console.error("Error parsing session:",e)}}toggleRepliesVisibility(t){this.replyVisibility[t]=!this.replyVisibility[t]}addComment(){this.newCommentContent.trim()&&this._commentsService.createComment({content:this.newCommentContent,reviewId:this.reviewId}).subscribe({next:t=>{let e={id:t,reviewId:this.reviewId,userId:this.currentUserId,userName:this.currentUserName,avatarUrl:this.currentUserAvatar,content:this.newCommentContent,likes:0,liked:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),replies:[]};this.comments.unshift(e),this.newCommentContent=""}})}toggleReply(t){this.replyingToId===t?(this.replyingToId=null,this.replyContent=""):(this.replyingToId=t,this.replyContent="")}sendReply(t){this.replyContent.trim()&&this._commentsService.replyToComment(t,{content:this.replyContent,reviewId:this.reviewId}).subscribe({next:e=>{let i={id:e,reviewId:this.reviewId,userId:this.currentUserId,userName:this.currentUserName,avatarUrl:this.currentUserAvatar,content:this.replyContent,likes:0,liked:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),parentId:t,replies:[]},r=this.comments.find(m=>m.id===t);r&&(r.replies||(r.replies=[]),r.replies.unshift(i),this.replyVisibility[t]=!0),this.replyingToId=null,this.replyContent=""}})}_supabaseClient=x(pe);paginationParams={page:1,size:10,total:0,hasNext:!1};loadComments(t=!1){t&&(this.paginationParams.page=1,this.comments=[]),this.isLoading=!0,this._commentsService.getCommentsByReview(this.reviewId,{page:this.paginationParams.page,size:this.paginationParams.size}).subscribe({next:e=>Q(this,null,function*(){let i=e.data.sort((g,b)=>new Date(b.createdAt).getTime()-new Date(g.createdAt).getTime()),r=new Set;i.forEach(g=>{r.add(g.userId),g.replies&&g.replies.forEach(b=>r.add(b.userId))});let m={};if(r.size>0){let{data:g}=yield this._supabaseClient.from("profile").select("id, avatarUrl").in("id",Array.from(r));g&&g.forEach(b=>{m[b.id]=b.avatarUrl})}i.forEach(g=>{g.avatarUrl=m[g.userId]||"/assets/images/defaultUser.png",g.replies&&g.replies.length>0&&(g.replies=[...g.replies].sort((b,Me)=>new Date(Me.createdAt).getTime()-new Date(b.createdAt).getTime()),g.replies.forEach(b=>{b.avatarUrl=m[b.userId]||"/assets/images/defaultUser.png"}))}),t?this.comments=i:this.comments=[...this.comments,...i],this.paginationParams.total=e.total,this.paginationParams.hasNext=e.hasNext||!1,this.isLoading=!1}),error:()=>{this.isLoading=!1}})}loadMoreComments(){this.paginationParams.hasNext&&!this.isLoading&&(this.paginationParams.page++,this.loadComments(!1))}toggleLike(t){let e=t.liked,i=t.likes;t.liked=!t.liked,t.likes+=t.liked?1:-1,(t.liked?this._commentsService.likeComment(t.id):this._commentsService.dislikeComment(t.id)).subscribe({error:()=>{t.liked=e,t.likes=i}})}startEdit(t){this.editingCommentId=t.id,this.editContent=t.content}cancelEdit(){this.editingCommentId=null,this.editContent=""}saveEdit(t){this.editContent.trim()&&this._commentsService.updateComment(t.id,{content:this.editContent}).subscribe({next:()=>{t.content=this.editContent,this.editingCommentId=null}})}dialog=x(Se);deleteComment(t){this.dialog.open(Ee,{width:"600px",maxWidth:"90vw",data:{title:"Eliminar Comentario",message:"\xBFEst\xE1s seguro de que deseas eliminar este comentario? Esta acci\xF3n no se puede deshacer."}}).afterClosed().subscribe(i=>{i&&(t.parentId?this._commentsService.deleteReply(t.id):this._commentsService.deleteComment(t.id)).subscribe({next:()=>{if(t.parentId){let m=this.comments.find(g=>g.id===t.parentId);m&&m.replies&&(m.replies=m.replies.filter(g=>g.id!==t.id))}else this.comments=this.comments.filter(m=>m.id!==t.id)}})})}isOwner(t){return t.userId===this.currentUserId}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=V({type:a,selectors:[["app-comments-list"]],inputs:{reviewId:"reviewId",currentUserId:"currentUserId"},decls:15,vars:5,consts:[["menu","matMenu"],["menuReply","matMenu"],[1,"mt-4"],[1,"flex","gap-2","mb-4"],["appearance","outline",1,"w-full"],["matInput","","placeholder","Comparte tu opini\xF3n",3,"ngModelChange","keyup.enter","ngModel"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[1,"flex","justify-center","py-4"],[1,"flex","flex-col","gap-4"],[1,"flex","flex-col","gap-2"],[1,"flex","justify-center","mt-4"],["diameter","30"],[1,"flex","gap-3"],["alt","Avatar",1,"w-8","h-8","rounded-full","object-cover","flex-shrink-0","bg-gray-300",3,"error","src"],[1,"flex-1"],[1,"bg-gray-100","rounded-lg","p-3"],[1,"flex","justify-between","items-start"],[1,"font-semibold","text-sm"],[1,"mt-2"],[1,"text-sm","text-gray-800","mt-1"],[1,"flex","items-center","gap-4","mt-1","ml-1","text-xs","text-gray-500"],[1,"flex","items-center","gap-1","hover:text-red-500","transition-colors",3,"click"],[1,"scale-75"],[1,"hover:text-blue-500",3,"click"],[1,"mt-2","flex","gap-2"],[1,"ml-11","flex","flex-col","gap-2"],["mat-icon-button","",1,"scale-75","-mt-2","-mr-2",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"text-red-600",3,"click"],[1,"text-red-600"],["matInput","",3,"ngModelChange","keyup.enter","ngModel"],[1,"flex","justify-end","gap-2","mt-1"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","Escribe una respuesta...","autoFocus","",3,"ngModelChange","keyup.enter","ngModel"],["mat-fab","","extended","",1,"w-fit","text-xs","text-blue-600","hover:bg-blue-50","px-2","py-1","h-auto","min-h-0",3,"click"],[1,"flex","items-center","gap-1"],[1,"scale-75","w-4","h-4","text-base","leading-none","flex","items-center","justify-center"],["alt","Avatar",1,"w-6","h-6","rounded-full","object-cover","flex-shrink-0","bg-gray-300",3,"error","src"],[1,"bg-gray-100","rounded-lg","p-2"],[1,"font-semibold","text-xs"],[1,"text-xs","text-gray-800","mt-1"],[1,"flex","items-center","gap-4","mt-1","ml-1","text-[10px]","text-gray-500"],["mat-stroked-button","","color","primary",3,"click"]],template:function(e,i){e&1&&(n(0,"div",2)(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),s(4,"Escribe un comentario..."),o(),n(5,"input",5),$("ngModelChange",function(m){return F(i.newCommentContent,m)||(i.newCommentContent=m),m}),c("keyup.enter",function(){return i.addComment()}),o(),n(6,"button",6),c("click",function(){return i.addComment()}),n(7,"mat-icon"),s(8,"send"),o()()()(),f(9,Oe,2,0,"div",7),n(10,"div",8),X(11,Ge,24,14,"div",9,Ue),o(),f(13,qe,3,0,"div",10),f(14,Je,2,0,"div",7),o()),e&2&&(l(5),L("ngModel",i.newCommentContent),l(),w("disabled",!i.newCommentContent.trim()),l(3),v(i.isLoading?9:-1),l(2),Z(i.comments),l(2),v(i.paginationParams.hasNext&&!i.isLoading?13:-1),l(),v(i.isLoading&&i.comments.length>0?14:-1))},dependencies:[O,xe,fe,ve,Ce,N,j,D,de,A,ce,ke,Ie,be,he,we,ye,_e,ue,W,B,H,z,me],encapsulation:2})};function Ye(a,t){if(a&1){let e=h();n(0,"button",27),c("click",function(){p(e);let r=d(2);return u(r.onGoToReview())}),n(1,"mat-icon"),s(2,"visibility"),o(),n(3,"span"),s(4,"Ir a la publicaci\xF3n"),o()()}}function Ke(a,t){if(a&1){let e=h();n(0,"div",3)(1,"button",24)(2,"mat-icon"),s(3,"more_vert"),o()(),n(4,"mat-menu",25,0),f(6,Ye,5,0,"button",26),n(7,"button",27),c("click",function(){p(e);let r=d();return u(r.onEdit())}),n(8,"mat-icon"),s(9,"edit"),o(),n(10,"span"),s(11,"Editar"),o()(),n(12,"button",28),c("click",function(){p(e);let r=d();return u(r.onDelete())}),n(13,"mat-icon",29),s(14,"delete"),o(),n(15,"span"),s(16,"Eliminar"),o()()()()}if(a&2){let e=k(5),i=d();l(),w("matMenuTriggerFor",e),l(5),v(i.showGoToReview?6:-1)}}function Qe(a,t){if(a&1){let e=h();n(0,"div",4)(1,"img",30),c("error",function(r){p(e);let m=d();return u(m.onImageError(r))}),o()()}if(a&2){let e=d();l(),w("src",e.moviePoster,U)("alt",e.title)}}function Xe(a,t){if(a&1){let e=h();n(0,"button",27),c("click",function(){p(e);let r=d(2);return u(r.onGoToReview())}),n(1,"mat-icon"),s(2,"visibility"),o(),n(3,"span"),s(4,"Ir a la publicaci\xF3n"),o()()}}function Ze(a,t){if(a&1){let e=h();n(0,"div",6)(1,"button",24)(2,"mat-icon"),s(3,"more_vert"),o()(),n(4,"mat-menu",25,0),f(6,Xe,5,0,"button",26),n(7,"button",27),c("click",function(){p(e);let r=d();return u(r.onEdit())}),n(8,"mat-icon"),s(9,"edit"),o(),n(10,"span"),s(11,"Editar"),o()(),n(12,"button",28),c("click",function(){p(e);let r=d();return u(r.onDelete())}),n(13,"mat-icon",29),s(14,"delete"),o(),n(15,"span"),s(16,"Eliminar"),o()()()()}if(a&2){let e=k(5),i=d();l(),w("matMenuTriggerFor",e),l(5),v(i.showGoToReview?6:-1)}}function et(a,t){if(a&1&&(n(0,"span",31),s(1," \u2605 "),o()),a&2){let e=t.$implicit;M("text-orange-400",e)("text-gray-300",!e)}}function tt(a,t){if(a&1&&(n(0,"span",32),s(1,"Publicado el:"),o(),n(2,"span",22),s(3),o()),a&2){let e=d();l(3),S(" ",e.formattedDate)}}function it(a,t){if(a&1&&(n(0,"span",32),s(1,"Publicado por:"),o(),n(2,"span",22),s(3),o()),a&2){let e=d();l(3),oe(" ",e.reviewerName," el ",e.formattedDate)}}function nt(a,t){if(a&1&&(n(0,"div",23),T(1,"app-comments-list",33),o()),a&2){let e=d();l(),w("reviewId",e.id)("currentUserId",e.currentUserId)}}var Te=class a{_likesService=x(J);id="";title="";content="";posterPath="";reviewerName="";directorName="";rating=0;createdAt="";userId="";currentUserId="";showImage=!0;showGoToReview=!1;likes=0;comments=0;liked=!1;editReview=new P;deleteReview=new P;goToReview=new P;get isOwner(){return this.userId===this.currentUserId&&!!this.currentUserId}onEdit(){this.editReview.emit(this.id)}onDelete(){this.deleteReview.emit(this.id)}onGoToReview(){this.goToReview.emit(this.id)}get stars(){return Array(5).fill(!1).map((t,e)=>e<this.rating)}get formattedDate(){return this.createdAt?new Date(this.createdAt).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):""}get moviePoster(){let t="assets/images/default-movie.png",e="https://image.tmdb.org/t/p/w500";return!this.posterPath||this.posterPath.trim()===""||this.posterPath==="null"||this.posterPath==="undefined"?t:`${e}${this.posterPath}`}onImageError(t){let e=t.target;e.src="assets/images/default-movie.png"}toggleLike(){if(!this.currentUserId)return;let t=this.liked,e=this.likes;this.liked=!this.liked,this.likes+=this.liked?1:-1,(this.liked?this._likesService.likeReview(this.id):this._likesService.dislikeReview(this.id)).subscribe({error:()=>{this.liked=t,this.likes=e}})}showComments=!1;toggleComments(){this.showComments=!this.showComments}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=V({type:a,selectors:[["app-card-review"]],inputs:{id:"id",title:"title",content:"content",posterPath:"posterPath",reviewerName:"reviewerName",directorName:"directorName",rating:"rating",createdAt:"createdAt",userId:"userId",currentUserId:"currentUserId",showImage:"showImage",showGoToReview:"showGoToReview",likes:"likes",comments:"comments",liked:"liked"},outputs:{editReview:"editReview",deleteReview:"deleteReview",goToReview:"goToReview"},decls:34,vars:13,consts:[["menu","matMenu"],[1,"bg-white","rounded-lg","p-6","shadow-lg","border-[0.5px]","border-[#757575]","w-full"],[1,"flex","flex-col","md:flex-col","lg:flex-col","2xl:flex-row","gap-3","md:gap-3","lg:gap-3"],[1,"w-full","flex","md:flex","lg:flex","2xl:hidden","justify-end"],[1,"flex","justify-center","md:justify-start"],[1,"flex","flex-col","w-full","justify-between"],[1,"w-full","hidden","md:hidden","lg:hidden","2xl:flex","3xl:flex","justify-end"],[1,"flex","flex-col"],[1,"flex","flex-col","md:flex-col","2xl:flex-col","items-start","2xl:items-start","flex-1"],[1,"text-xl","md:text-3xl","font-bold","text-gray-900"],[1,"flex","gap-0.5","ml-0","md:ml-4","lg:ml-0","mt-2","2xl:mt-0"],["class","text-2xl",3,"text-orange-400","text-gray-300",4,"ngFor","ngForOf"],[1,"text-gray-600","text-sm","md:text-base","mb-2"],[1,"font-semibold"],[1,"text-gray-700","text-xs","md:text-base","leading-relaxed","mb-1"],[1,"flex","flex-col","w-full","md:flex-row","justify-between","items-start","md:items-center","mt-auto"],[1,"text-gray-600"],[1,"flex","items-center","gap-4","mt-2","md:mt-0"],[1,"flex","items-center","gap-1","text-gray-600","cursor-pointer","hover:opacity-80","transition-opacity",3,"click"],[1,"scale-75","md:scale-100","transition-transform","active:scale-90",3,"ngClass"],[1,"text-xs","md:text-base","select-none"],[1,"scale-75","md:scale-100"],[1,"text-xs","md:text-base"],[1,"w-full","border-t","border-gray-200","mt-4","pt-4"],["mat-icon-button","",1,"text-gray-700",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"text-red-600",3,"click"],[1,"text-red-600"],[1,"w-[150px]","md:w-[220px]","h-[210px]","md:h-[320px]","object-cover","flex-shrink-0","rounded-lg","shadow-xl","border-[0.5px]","border-[#757575]",3,"error","src","alt"],[1,"text-2xl"],[1,"font-semibold","text-xs","md:text-base"],[3,"reviewId","currentUserId"]],template:function(e,i){e&1&&(n(0,"div",1)(1,"div",2),f(2,Ke,17,2,"div",3),f(3,Qe,2,2,"div",4),n(4,"div",5),f(5,Ze,17,2,"div",6),n(6,"div",7)(7,"div",8)(8,"h2",9),s(9),o(),n(10,"div",10),ae(11,et,2,4,"span",11),o()(),n(12,"p",12)(13,"span",13),s(14,"Director:"),o(),s(15),o(),n(16,"p",14),s(17),o()(),n(18,"div",15)(19,"p",16),f(20,tt,4,1)(21,it,4,2),o(),n(22,"div",17)(23,"div",18),c("click",function(){return i.toggleLike()}),n(24,"mat-icon",19),s(25),o(),n(26,"span",20),s(27),o()(),n(28,"div",18),c("click",function(){return i.toggleComments()}),n(29,"mat-icon",21),s(30,"chat_bubble_outline"),o(),n(31,"span",22),s(32),o()()()()()(),f(33,nt,2,2,"div",23),o()),e&2&&(l(2),v(i.isOwner?2:-1),l(),v(i.showImage?3:-1),l(2),v(i.isOwner?5:-1),l(4),C(i.title),l(2),w("ngForOf",i.stars),l(4),S(" ",i.directorName," "),l(2),S(" ",i.content," "),l(3),v(i.showGoToReview?20:21),l(4),w("ngClass",i.liked?"text-red-500 hover:text-gray-500":"hover:text-red-500"),l(),C(i.liked?"favorite":"favorite_border"),l(2),C(i.likes),l(5),C(i.comments),l(),v(i.showComments?33:-1))},dependencies:[O,se,le,N,j,W,B,H,z,D,A,K],styles:["[_nghost-%COMP%]{display:block}"]})};export{Re as a,Te as b};
