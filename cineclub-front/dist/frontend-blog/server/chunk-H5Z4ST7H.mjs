import './polyfills.server.mjs';
import{a as _}from"./chunk-KXZRHGC3.mjs";import"./chunk-IZYF7JLB.mjs";import{a as C}from"./chunk-QFWZF5PC.mjs";import{a as b}from"./chunk-XD35RQRI.mjs";import"./chunk-3YY5WZBW.mjs";import{l as w}from"./chunk-6XZJ4HF4.mjs";import"./chunk-BKMGEJ4V.mjs";import{a as c}from"./chunk-ABBCMJJI.mjs";import{f as n}from"./chunk-5Y2PL6TA.mjs";import"./chunk-TPI6FTCS.mjs";import{V as f,Xa as v,_ as o,cd as k,ub as y,vb as g,wb as S,za as h}from"./chunk-I37AKPGM.mjs";import"./chunk-BPPYXBGU.mjs";import{a as m,b as u,h as a}from"./chunk-S6KH3LOX.mjs";var l=class e{_tokenService=o(C);_router=o(n);_notificationsService=o(w);handleCallback(){return a(this,null,function*(){try{this._tokenService.clearSession();let{data:r,error:t}=yield c.auth.exchangeCodeForSession(window.location.href);if(t)throw console.error("\u274C [Callback] Error en exchangeCodeForSession:",t),t;if(!r.session||!r.user)throw console.error("\u274C [Callback] No se obtuvo sesi\xF3n o usuario"),new Error("No se pudo obtener sesi\xF3n.");let{data:i,error:d}=yield c.from("profile").select(`
          id,
          roleTypeId,
          roleType:roleType!fk_profile_roletype (
            id,
            code,
            name
          )
        `).eq("id",r.user.id).single();if(d)throw console.error("\u274C Error al obtener perfil:",d),d;let A=u(m({},i),{roleType:Array.isArray(i.roleType)?i.roleType[0]:i.roleType});this._tokenService.saveSession(r.session.access_token,r.session.refresh_token,A),this._notificationsService.success("\xA1Cuenta verificada exitosamente! Bienvenido."),yield this._router.navigateByUrl("/")}catch(r){console.error("\u274C Error en handleCallback:",r),yield c.auth.signOut(),this._tokenService.clearSession(),this._notificationsService.info("Tu cuenta ha sido verificada exitosamente. Por favor, inicia sesi\xF3n con tus credenciales."),yield this._router.navigateByUrl("/auth/login")}})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=f({token:e,factory:e.\u0275fac,providedIn:"root"})};var p=class e{_authCallbackService=o(l);_router=o(n);_platformId=o(h);ngOnInit(){return a(this,null,function*(){if(k(this._platformId))try{yield this._authCallbackService.handleCallback()}catch(r){console.error("\u274C Error durante el callback:",r),yield this._router.navigate(["/auth/login"])}})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=v({type:e,selectors:[["app-auth-call-back"]],decls:3,vars:0,consts:[[1,"flex","items-center","justify-center","min-h-screen","bg-[#121212]"],[1,"text-center"]],template:function(t,i){t&1&&(y(0,"div",0)(1,"div",1),S(2,"app-loader"),g()())},dependencies:[_],encapsulation:2})};var s=()=>a(null,null,function*(){let e=o(b),r=o(n);yield e.waitForAuthReady();let{data:t}=yield e.getSession();return t.session?r.createUrlTree(["/"]):!0});var Z=[{path:"",children:[{path:"login",loadComponent:()=>import("./chunk-7OETLNUW.mjs").then(e=>e.Login),canActivate:[s],\u0275entryName:"src/app/auth/pages/login/login.ts"},{path:"register",loadComponent:()=>import("./chunk-FAPYANK7.mjs").then(e=>e.Register),canActivate:[s],\u0275entryName:"src/app/auth/pages/register/register.ts"},{path:"recover-password",loadComponent:()=>import("./chunk-EHIGRBLE.mjs").then(e=>e.RecoverPassword),canActivate:[s],\u0275entryName:"src/app/auth/pages/recover-password/recover-password.ts"},{path:"set-password",loadComponent:()=>import("./chunk-BI4YRW2D.mjs").then(e=>e.SetPassword),\u0275entryName:"src/app/auth/pages/set-password/set-password.ts"},{path:"callback",component:p},{path:"send-email",loadComponent:()=>import("./chunk-QEBNKSOD.mjs").then(e=>e.SendEmail),canActivate:[s],\u0275entryName:"src/app/auth/pages/send-email/send-email.ts"}]}];export{Z as authRoutes};
