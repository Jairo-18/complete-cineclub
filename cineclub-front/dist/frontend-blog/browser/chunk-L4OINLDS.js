import{a as ae}from"./chunk-QXROUS5G.js";import{a as re}from"./chunk-QLWIP4YL.js";import{a as B,b as R,c as W,d as z}from"./chunk-6GLRXAZ6.js";import"./chunk-6P4IF4CI.js";import"./chunk-XNBUNGCT.js";import{a as U}from"./chunk-D6LKXYUQ.js";import{a as q,b as A}from"./chunk-Z6PT2AXA.js";import"./chunk-VN3CQEPZ.js";import{b as ne,c as oe}from"./chunk-LYMOFPMC.js";import{A as ee,D as te,E as ie,e as J,j as Y,n as K,u as Q,w as X,z as Z}from"./chunk-EK5XN74M.js";import{l as V,o as $}from"./chunk-J6OIAH2E.js";import"./chunk-E6SG4RJT.js";import{b as j,c as H}from"./chunk-JNEX3YXP.js";import{l as G}from"./chunk-ZUAAQJ5J.js";import"./chunk-YUIT4C56.js";import{Bb as s,Ca as S,Ec as k,Fc as N,Ga as a,Lb as L,Pb as l,Qb as T,Rb as u,Sa as E,Tb as P,Ub as I,Vb as F,_ as x,bc as D,da as f,dc as O,ea as g,gb as m,hb as d,jb as w,kb as M,lb as b,mb as y,nb as r,ob as o,pb as C,wb as _,zb as v}from"./chunk-4XNWJBNU.js";import"./chunk-ODN5LVDJ.js";var le=(i,t)=>t.id;function se(i,t){if(i&1){let e=_();r(0,"button",12),v("click",function(){f(e);let c=s();return g(c.clearSearch())}),r(1,"mat-icon"),l(2,"close"),o()()}}function ce(i,t){i&1&&(r(0,"div",10)(1,"div",13),C(2,"app-loader"),o()())}function me(i,t){if(i&1&&(r(0,"span",31),l(1),o()),i&2){let e=t.$implicit;a(),u(" ",e," ")}}function de(i,t){if(i&1&&(r(0,"div",26),M(1,me,2,1,"span",31,w),o()),i&2){let e=s().$implicit,n=s(2);a(),b(n.parseGenres(e.genres))}}function pe(i,t){if(i&1){let e=_();r(0,"button",32),v("click",function(){f(e);let c=s().$implicit,p=s(2);return g(p.toggleOverview(c.id))}),l(1),o()}if(i&2){let e=s().$implicit,n=s(2);a(),u(" ",n.isOverviewExpanded(e.id)?"Ver menos":"Ver m\xE1s"," ")}}function ue(i,t){if(i&1&&(r(0,"p",30)(1,"span",25),l(2,"Estreno:"),o(),l(3),D(4,"date"),o()),i&2){let e=s().$implicit;a(3),u(" ",O(4,1,e.releaseDate,"dd/MM/yyyy")," ")}}function ve(i,t){if(i&1&&(r(0,"p",30)(1,"span",25),l(2,"Duraci\xF3n:"),o(),l(3),o()),i&2){let e=s().$implicit,n=s(2);a(3),u(" ",n.formatRuntime(e.runtime)," ")}}function fe(i,t){if(i&1){let e=_();r(0,"div",15)(1,"div",17)(2,"button",18)(3,"mat-icon"),l(4,"more_vert"),o()(),r(5,"mat-menu",null,0)(7,"button",19),v("click",function(){let c=f(e).$implicit,p=s(2);return g(p.guardarPelicula(c))}),r(8,"mat-icon"),l(9,"bookmark_add"),o(),r(10,"span"),l(11,"Guardar pel\xEDcula"),o()()()(),r(12,"div",20)(13,"img",21),v("error",function(c){f(e);let p=s(2);return g(p.onImageError(c))}),o()(),r(14,"div",22)(15,"h3",23),l(16),o(),r(17,"p",24)(18,"span",25),l(19,"Director:"),o(),l(20),o(),m(21,de,3,0,"div",26),r(22,"p",27),l(23),m(24,pe,2,1,"button",28),o(),r(25,"div",29),m(26,ue,5,4,"p",30),m(27,ve,4,1,"p",30),o()()()}if(i&2){let e=t.$implicit,n=L(6),c=s(2);a(2),y("matMenuTriggerFor",n),a(11),y("src",c.getMoviePoster(e.posterPath),S)("alt",e.title),a(3),T(e.title),a(4),u(" ",e.director," "),a(),d(e.genres?21:-1),a(2),u(" ",c.getDisplayedOverview(e)||"Sin descripci\xF3n disponible."," "),a(),d(((e.overview==null?null:e.overview.length)||0)>150?24:-1),a(2),d(e.releaseDate?26:-1),a(),d(e.runtime?27:-1)}}function ge(i,t){i&1&&(r(0,"div",16),C(1,"mat-spinner",33),o())}function xe(i,t){if(i&1&&(r(0,"div",14),M(1,fe,28,10,"div",15,le),o(),m(3,ge,2,0,"div",16)),i&2){let e=s();a(),b(e.movies),a(2),d(e.isLoadingMore?3:-1)}}function _e(i,t){if(i&1&&l(0),i&2){let e=s(2);u(' No se encontraron pel\xEDculas con "',e.searchTerm,'" ')}}function he(i,t){i&1&&l(0," No hay pel\xEDculas disponibles por el momento. ")}function Me(i,t){if(i&1&&(r(0,"p",11),m(1,_e,1,1)(2,he,1,0),o()),i&2){let e=s();a(),d(e.searchTerm?1:2)}}var h=class i{_collectionsService=x(ae);_moviesService=x(re);_notificationsService=x(G);movies=[];loading=!0;isLoadingMore=!1;paginationParams={page:1,size:12,total:0,totalPages:0,hasNext:!1,hasPrevious:!1};searchTerm="";searchTimeout;ngOnInit(){this.fetchMovies(),this.setupScrollListener()}ngOnDestroy(){let t=document.querySelector("main.main");t?t.removeEventListener("scroll",this.scrollListener):window.removeEventListener("scroll",this.scrollListener)}scrollListener=()=>{let t=document.querySelector("main.main");t?this.checkScroll(t):this.checkScrollWindow()};setupScrollListener(){let t=document.querySelector("main.main");t?t.addEventListener("scroll",this.scrollListener):window.addEventListener("scroll",this.scrollListener)}checkScroll(t){let e=t.scrollTop+t.clientHeight,n=t.scrollHeight;e/n*100>=50&&this.paginationParams.hasNext&&!this.isLoadingMore&&!this.loading&&this.loadMoreMovies()}checkScrollWindow(){let t=window.pageYOffset+window.innerHeight,e=document.documentElement.scrollHeight;t/e*100>=50&&this.paginationParams.hasNext&&!this.isLoadingMore&&!this.loading&&this.loadMoreMovies()}onSearchChange(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.paginationParams.page=1,this.fetchMovies(!0)},500)}clearSearch(){this.searchTerm="",this.paginationParams.page=1,this.paginationParams.size=12,this.fetchMovies(!0)}fetchMovies(t=!1){t&&(this.loading=!0,this.movies=[]);let e={page:this.paginationParams.page,size:this.paginationParams.size};this.searchTerm&&this.searchTerm.trim()&&(e.title=this.searchTerm.trim()),this._moviesService.getMoviesWithPagination(e).subscribe({next:n=>{t?this.movies=n.data:this.movies=[...this.movies,...n.data],this.loading=!1,this.isLoadingMore=!1,this.paginationParams.total=n.total||0,this.paginationParams.totalPages=n.totalPages||0,this.paginationParams.hasNext=n.hasNext||!1,this.paginationParams.hasPrevious=n.hasPrevious||!1},error:n=>{console.error("Error fetching movies:",n),this.loading=!1,this.isLoadingMore=!1}})}loadMoreMovies(){this.paginationParams.hasNext&&!this.isLoadingMore&&(this.isLoadingMore=!0,this.paginationParams.page++,this.fetchMovies(!1))}guardarPelicula(t){this._collectionsService.saveMovieToCollection(t.id).subscribe({next:()=>{},error:e=>{console.error("Error al guardar la pel\xEDcula:",e),e.status===409?this._notificationsService.error("Pel\xEDcula ya guardada"):this._notificationsService.error("\u274C No se pudo guardar la pel\xEDcula.")}})}formatRuntime(t){if(!t)return"No disponible";let e=Math.floor(t/60),n=t%60;return`${e}h ${n}min`}parseGenres(t){if(!t)return[];try{if(Array.isArray(t))return t.map(e=>e.name);if(typeof t=="string"){let e=t.replace(/'/g,'"');return JSON.parse(e).map(c=>c.name)}return[]}catch(e){return console.error("Error parsing genres:",e),[]}}getMoviePoster(t){let e="assets/images/default-movie.png",n="https://image.tmdb.org/t/p/w500";return!t||t.trim()===""||t==="null"||t==="undefined"?e:`${n}${t}`}onImageError(t){let e=t.target;e.src="assets/images/default-movie.png"}expandedOverviews={};toggleOverview(t){this.expandedOverviews[t]=!this.expandedOverviews[t]}isOverviewExpanded(t){return this.expandedOverviews[t]||!1}getDisplayedOverview(t){let e=t.overview||"";return e.length<=150||this.isOverviewExpanded(t.id)?e:e.slice(0,150)+"..."}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=E({type:i,selectors:[["app-library-movies"]],decls:17,vars:4,consts:[["menu","matMenu"],[1,"w-full","text-black","flex","flex-col","items-center","justify-center","p-3","md:px-6","py-6","md:py-12"],[1,"flex","flex-col","justify-start","w-full"],[1,"text-lg","md:text-3xl","lg:text-4xl","2xl:text-5xl","3xl:text-6xl","font-extrabold","text-[#9811fb]","drop-shadow-md"],[1,"text-sm","md:text-base","lg:text-lg","2xl:text-lg","3xl:text-lg","font-semibold","mb-4","text-[#757575]"],[1,"w-full"],["appearance","outline",1,"w-full"],["matInput","","type","text","placeholder","Ej: Action, Drama, Inception...",3,"ngModelChange","ngModel"],["matPrefix",""],["matSuffix","","mat-icon-button",""],[1,"flex","flex-col","items-center","justify-center","gap-2","text-gray-600"],[1,"text-gray-600","mt-8","text-lg","text-center"],["matSuffix","","mat-icon-button","",3,"click"],[1,"flex","justify-center","items-center"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-6"],[1,"flex","flex-col","bg-[#F0F4F9]","rounded-lg","p-4","shadow-lg","border-[0.5px]","border-[#757575]","relative"],[1,"flex","justify-center","items-center","py-6"],[1,"flex","flex-col","w-full","justify-end","items-end","mb-2"],["mat-icon-button","",1,"text-gray-500","hover:text-gray-800","transition-colors",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"relative","w-full","aspect-[2/3]","mb-4"],[1,"w-full","h-full","object-cover","rounded-lg","shadow-xl","border-[0.5px]","border-[#757575]",3,"error","src","alt"],[1,"flex","flex-col","flex-1","text-left"],[1,"text-lg","font-bold","text-gray-900","mb-2","line-clamp-2"],[1,"text-gray-600","text-sm","mb-2"],[1,"font-semibold"],[1,"flex","flex-wrap","gap-1.5","mb-3"],[1,"text-gray-700","text-sm","leading-relaxed","mb-3","line-clamp-none","flex-1"],[1,"text-[#9811fb]","text-xs","font-semibold","hover:underline","ml-1"],[1,"flex","flex-col","gap-1","text-gray-600","text-xs","mt-auto"],[1,"text-gray-600","text-sm"],[1,"px-2","py-0.5","text-xs","bg-[#9811fb]","border","border-gray-300","rounded-full","text-white"],[1,"text-[#9811fb]","text-xs","font-semibold","hover:underline","ml-1",3,"click"],["diameter","40"]],template:function(e,n){e&1&&(r(0,"article",1)(1,"div",2)(2,"span",3),l(3," Pel\xEDculas disponibles "),o(),r(4,"span",4),l(5," Explora y guarda las pel\xEDculas que m\xE1s te gusten en tu biblioteca personal "),o()(),r(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),l(9,"Buscar por t\xEDtulo o g\xE9nero"),o(),r(10,"input",7),F("ngModelChange",function(p){return I(n.searchTerm,p)||(n.searchTerm=p),p}),v("ngModelChange",function(){return n.onSearchChange()}),o(),r(11,"mat-icon",8),l(12,"search"),o(),m(13,se,3,0,"button",9),o()(),m(14,ce,3,0,"div",10),m(15,xe,4,1)(16,Me,3,1,"p",11),o()),e&2&&(a(10),P("ngModel",n.searchTerm),a(3),d(n.searchTerm?13:-1),a(),d(n.loading?14:-1),a(),d(!n.loading&&n.movies.length>0?15:n.loading?-1:16))},dependencies:[N,Q,J,Y,K,z,R,B,W,H,j,$,V,oe,ne,te,X,Z,ee,ie,A,q,U,k],encapsulation:2})};var Je=[{path:"",children:[{path:"library",component:h},{path:"top",loadComponent:()=>import("./chunk-PLYITVO2.js").then(i=>i.TopMovies)}]}];export{Je as moviesRoutes};
