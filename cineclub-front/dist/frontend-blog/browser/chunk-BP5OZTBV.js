import{b as fe}from"./chunk-NBVXWU6R.js";import{a as Z}from"./chunk-5RLPUM7S.js";import"./chunk-6P4IF4CI.js";import{d as me}from"./chunk-LFZXF7JA.js";import"./chunk-XNBUNGCT.js";import{a as X}from"./chunk-D6LKXYUQ.js";import{a as J,b as K}from"./chunk-Z6PT2AXA.js";import"./chunk-VN3CQEPZ.js";import{b as de,c as ce}from"./chunk-LYMOFPMC.js";import{A as ae,D as se,E as le,e as ee,j as te,n as ie,u as ne,w as re,z as oe}from"./chunk-EK5XN74M.js";import{l as B,m as z,n as W,o as A}from"./chunk-J6OIAH2E.js";import"./chunk-E6SG4RJT.js";import{f as U}from"./chunk-NSQ4QIVB.js";import{b as Y}from"./chunk-JNEX3YXP.js";import{l as $}from"./chunk-ZUAAQJ5J.js";import"./chunk-YUIT4C56.js";import{a as G}from"./chunk-AOTVPSR2.js";import{Bb as m,Ca as N,Ec as O,Fc as F,Ga as l,Pb as a,Qb as D,Rb as u,Sa as y,Tb as H,Ub as Q,Vb as R,_ as x,_b as V,bc as j,da as C,dc as q,ea as v,gb as f,hb as p,kb as k,lb as L,mb as w,nb as n,ob as r,pb as h,wb as E,zb as _}from"./chunk-4XNWJBNU.js";import"./chunk-X5YLR3NI.js";import{a as b,b as M,i as I}from"./chunk-ODN5LVDJ.js";var xe=i=>["/profile/public-profile",i],he=(i,t)=>t.id;function _e(i,t){if(i&1){let e=E();n(0,"button",7),_("click",function(){C(e);let s=m();return v(s.clearSearch())}),n(1,"mat-icon"),a(2,"close"),r()()}}function Ce(i,t){i&1&&(n(0,"div",6)(1,"div",8),h(2,"app-loader"),r()())}function ve(i,t){if(i&1&&(n(0,"p",9),a(1),r()),i&2){let e=m(3);l(),u(' No se encontraron amigos con el nombre "',e.searchQuery,'". ')}}function ye(i,t){i&1&&(n(0,"p",9),a(1,"No tienes amigos agregados."),r())}function Fe(i,t){if(i&1&&f(0,ve,2,1,"p",9)(1,ye,2,0,"p",9),i&2){let e=m(2);p(e.searchQuery?0:1)}}function Se(i,t){if(i&1){let e=E();n(0,"div",11)(1,"div",13)(2,"div",14)(3,"img",15),_("error",function(s){C(e);let d=m(3);return v(d.onImageError(s))}),r(),n(4,"div",16)(5,"span",17),a(6),r(),n(7,"span",18),a(8),r(),n(9,"p",19),a(10),r(),n(11,"p",20),a(12),j(13,"date"),r()()(),n(14,"div",21)(15,"button",22)(16,"mat-icon",23),a(17,"visibility"),r(),n(18,"span"),a(19,"Ver perfil"),r()(),n(20,"button",24),_("click",function(){let s=C(e).$implicit,d=m(3);return v(d.openRemoveFriendDialog(s.friend.id,s.friend.fullName))}),n(21,"mat-icon",23),a(22,"person_remove"),r(),n(23,"span"),a(24,"Eliminar amigo"),r()()()()()}if(i&2){let e=t.$implicit;l(3),w("src",e.friend.avatarUrl||"/assets/images/defaultUser.png",N),l(3),u(" ",e.friend.fullName," "),l(2),u(" ","@"+(e.friend.username||"usuario")," "),l(2),D(e.friend.email),l(2),u(" Amigos desde: ",q(13,6,e.createdAt,"dd/MM/yyyy")," "),l(3),w("routerLink",V(9,xe,e.friend.id))}}function be(i,t){i&1&&(n(0,"div",12),h(1,"mat-spinner",25),r())}function Me(i,t){if(i&1&&(n(0,"div",10),k(1,Se,25,11,"div",11,he),r(),f(3,be,2,0,"div",12)),i&2){let e=m(2);l(),L(e.friends),l(2),p(e.isLoadingMore?3:-1)}}function we(i,t){if(i&1&&f(0,Fe,2,1)(1,Me,4,1),i&2){let e=m();p(e.friends.length===0?0:1)}}var S=class i{friends=[];loading=!1;isLoadingMore=!1;currentPage=1;pageSize=5;total=0;totalPages=0;hasNext=!1;hasPrevious=!1;searchQuery="";searchTimeout;_friendRequestService=x(Z);_dialog=x(me);_notificationsService=x($);_supabaseClient=x(G);ngOnInit(){this.loadFriends(),this.setupScrollListener()}scrollHandler=null;scrollTarget=null;ngOnDestroy(){this.scrollTarget&&this.scrollHandler&&this.scrollTarget.removeEventListener("scroll",this.scrollHandler)}setupScrollListener(){let t=document.querySelector("main.main");this.scrollTarget=t||window,this.scrollHandler=()=>{t?this.checkScroll(t):this.checkScrollWindow()},this.scrollTarget.addEventListener("scroll",this.scrollHandler)}checkScroll(t){let e=t.scrollTop+t.clientHeight,o=t.scrollHeight;e/o*100>=50&&this.hasNext&&!this.isLoadingMore&&!this.loading&&this.loadMoreFriends()}checkScrollWindow(){let t=window.pageYOffset+window.innerHeight,e=document.documentElement.scrollHeight;t/e*100>=50&&this.hasNext&&!this.isLoadingMore&&!this.loading&&this.loadMoreFriends()}onSearchChange(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.currentPage=1,this.loadFriends(!0)},500)}clearSearch(){this.searchQuery="",this.currentPage=1,this.loadFriends(!0)}loadFriends(t=!1){t&&(this.currentPage=1,this.friends=[]),this.currentPage===1&&(this.loading=!0);let e={page:this.currentPage,size:this.pageSize,sort:"createdAt,desc"};this.searchQuery&&this.searchQuery.trim()&&(e.name=this.searchQuery.trim()),this._friendRequestService.getFriends(e).subscribe({next:o=>I(this,null,function*(){let s=o.data||[],d=s.map(c=>c.friend.id),T={};if(d.length>0){let{data:c}=yield this._supabaseClient.from("profile").select("id, username, avatarUrl").in("id",d);c&&c.forEach(g=>{T[g.id]=g})}let P=s.map(c=>{let g=T[c.friend.id];return M(b({},c),{friend:M(b({},c.friend),{username:g?.username||c.friend.username||"@usuario",avatarUrl:g?.avatarUrl||"/assets/images/defaultUser.png"})})});t?this.friends=P:this.friends=[...this.friends,...P],this.total=o.total,this.totalPages=o.totalPages,this.hasNext=o.hasNext,this.hasPrevious=o.hasPrevious,this.loading=!1,this.isLoadingMore=!1}),error:o=>{console.error("Error al obtener amigos:",o),this._notificationsService.error("Error al cargar amigos"),this.loading=!1,this.isLoadingMore=!1}})}loadMoreFriends(){this.hasNext&&!this.isLoadingMore&&(this.isLoadingMore=!0,this.currentPage++,this.loadFriends(!1))}openRemoveFriendDialog(t,e){this._dialog.open(fe,{data:{title:"\xBFEliminar amigo?",message:`\xBFEst\xE1s seguro de que deseas eliminar a ${e} de tu lista de amigos?`}}).afterClosed().subscribe(s=>{s&&this.removeFriend(t)})}removeFriend(t){this.loading=!0,this._friendRequestService.removeFriend(t).subscribe({next:()=>{this.currentPage=1,this.loadFriends(!0)},error:e=>{console.error(e),this._notificationsService.error("No se pudo eliminar"),this.loading=!1}})}onImageError(t){let e=t.target;e.src="/assets/images/defaultUser.png"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-friends-content"]],decls:12,vars:4,consts:[[1,"text-center","text-black"],[1,"text-sm","text-gray-500","mb-2"],["appearance","outline",1,"w-full","mb-4"],["matInput","","type","text","placeholder","Escribe el nombre...",3,"ngModelChange","ngModel"],["matPrefix",""],["matSuffix","","mat-icon-button","",1,"text-gray-500"],[1,"flex","flex-col","items-center","justify-center","gap-2","text-gray-600","mt-8"],["matSuffix","","mat-icon-button","",1,"text-gray-500",3,"click"],[1,"flex","justify-center","items-center"],[1,"text-gray-600","mt-8","text-lg"],[1,"flex","flex-col","gap-4","w-full"],[1,"bg-[#F0F4F9]","rounded-lg","shadow-lg","border-[0.5px]","border-[#757575]","p-5","flex","items-center","gap-4","hover:shadow-lg","hover:scale-[1.01]","transition-all","duration-300"],[1,"flex","justify-center","items-center","py-6"],[1,"flex","flex-col","md:flex-row","w-full"],[1,"flex","flex-col","md:flex-row","w-full","md:w-[60%]","lg:w-[70%]","justify-center","md:justify-start","items-center","md:items-start","gap-0","md:gap-2"],["alt","avatar","referrerpolicy","no-referrer","crossorigin","anonymous",1,"w-[70px]","md:w-[100px]","h-[70px]","md:h-[100px]","rounded-full","border-2","border-indigo-200",3,"error","src"],[1,"flex","flex-col","h-full","items-start","justify-center"],[1,"text-lg","font-bold","text-black"],[1,"text-sm","text-gray-600","font-medium"],[1,"text-sm","md:text-base","text-gray-500"],[1,"text-xs","md:text-sm","text-gray-400","mt-1"],[1,"flex","flex-col","w-full","md:w-[40%]","lg:w-[30%]","items-center","gap-2","mt-2","md:mt-0"],["mat-fab","","extended","",1,"!w-full",3,"routerLink"],[1,"text-base"],["mat-raised-button","","color","warn",1,"w-full","!bg-red-600","!text-white",3,"click"],["diameter","40"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"p",1),a(2),r(),n(3,"mat-form-field",2)(4,"mat-label"),a(5,"Buscar amigo por nombre"),r(),n(6,"input",3),R("ngModelChange",function(d){return Q(o.searchQuery,d)||(o.searchQuery=d),d}),_("ngModelChange",function(){return o.onSearchChange()}),r(),n(7,"mat-icon",4),a(8,"search"),r(),f(9,_e,3,0,"button",5),r(),f(10,Ce,3,0,"div",6)(11,we,2,1),r()),e&2&&(l(2),u("Total: ",o.total," perfiles"),l(4),H("ngModel",o.searchQuery),l(3),p(o.searchQuery?9:-1),l(),p(o.loading?10:11))},dependencies:[F,U,Y,X,A,z,B,W,ce,de,se,re,oe,ae,le,ne,ee,te,ie,K,J,O],styles:["[_nghost-%COMP%]{display:block}"]})};var pe=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-my-friends"]],decls:8,vars:0,consts:[[1,"text-black","flex","flex-col","items-center","justify-center","p-3","md:px-6","py-6","md:py-12"],[1,"flex","flex-col","justify-start","w-full","gap-2"],[1,"text-lg","md:text-3xl","lg:text-4xl","2xl:text-5xl","3xl:text-6xl","font-extrabold","text-[#9811fb]","drop-shadow-md"],[1,"text-sm","md:text-base","lg:text-lg","2xl:text-lg","3xl:text-lg","font-semibold","mb-4","text-[#757575]"],[1,"w-full"]],template:function(e,o){e&1&&(n(0,"article",0)(1,"div",1)(2,"span",2),a(3," Tus amigos "),r(),n(4,"span",3),a(5," Visualiza y gestiona tu lista de amigos aqu\xED "),r()(),n(6,"div",4),h(7,"app-friends-content"),r()())},dependencies:[F,S],styles:["[_nghost-%COMP%]{display:block}"]})};export{pe as MyFriends};
