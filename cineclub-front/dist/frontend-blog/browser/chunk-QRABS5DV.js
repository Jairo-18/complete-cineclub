import{a as se,b as de}from"./chunk-ELQ4CZ6G.js";import"./chunk-NBVXWU6R.js";import"./chunk-32UPDBY4.js";import"./chunk-6GLRXAZ6.js";import"./chunk-6P4IF4CI.js";import"./chunk-LFZXF7JA.js";import"./chunk-XNBUNGCT.js";import{a as Y,b as K}from"./chunk-Z6PT2AXA.js";import"./chunk-VN3CQEPZ.js";import{b as ae,c as le}from"./chunk-LYMOFPMC.js";import{A as ne,D as re,E as oe,e as X,j as Z,n as $,u as ee,w as te,z as ie}from"./chunk-EK5XN74M.js";import{n as W,o as q}from"./chunk-J6OIAH2E.js";import"./chunk-E6SG4RJT.js";import{c as H,e as S}from"./chunk-NSQ4QIVB.js";import{b as M,c as F}from"./chunk-JNEX3YXP.js";import{l as G}from"./chunk-ZUAAQJ5J.js";import"./chunk-YUIT4C56.js";import{a as J}from"./chunk-AOTVPSR2.js";import{Bb as c,Ca as R,Ec as z,Fc as C,Ga as a,Pb as l,Qb as V,Rb as g,Sa as y,Tb as B,Ub as O,Vb as U,_ as f,bc as A,da as v,dc as Q,ea as h,gb as m,hb as p,jc as L,kb as k,lb as D,mb as b,na as _,nb as n,ob as r,pb as x,ra as I,wb as w,yc as j,zb as u}from"./chunk-4XNWJBNU.js";import"./chunk-X5YLR3NI.js";import{a as P,i as N}from"./chunk-ODN5LVDJ.js";function ge(i,t){i&1&&(n(0,"div",0),x(1,"div",2),n(2,"p",3),l(3,"Cargando perfil..."),r()())}function ve(i,t){if(i&1){let e=w();n(0,"button",17),u("click",function(){v(e);let d=c(2);return h(d.toggleBibliography())}),l(1),r()}if(i&2){let e=c(2);a(),g(" ",e.showFullBibliography()?"Ver menos":"Ver m\xE1s..."," ")}}function he(i,t){if(i&1&&(n(0,"div",8)(1,"mat-icon",15),l(2,"public"),r(),n(3,"span",18),l(4),r()()),i&2){let e=c(2);a(4),g(" ",e.profile().country," ")}}function xe(i,t){if(i&1){let e=w();n(0,"div",1)(1,"div",4)(2,"button",5),u("click",function(){v(e);let d=c();return h(d.goBack())}),n(3,"mat-icon",6),l(4,"arrow_back"),r(),l(5," Volver "),r()(),n(6,"img",7),u("error",function(d){v(e);let s=c();return h(s.onImageError(d))}),r(),n(7,"div",8)(8,"span",9),l(9),r()(),n(10,"div",8)(11,"span",10),l(12),r()(),n(13,"div",11)(14,"span",12),l(15),r(),m(16,ve,2,1,"button",13),r(),n(17,"div",14),m(18,he,5,1,"div",8),n(19,"div",8)(20,"mat-icon",15),l(21,"calendar_today"),r(),n(22,"span",16),l(23),A(24,"date"),r()()()()}if(i&2){let e,o,d,s=c();a(6),b("src",s.avatarUrl(),R),a(3),g(" ",((e=s.profile())==null?null:e.fullName)||"Usuario"," "),a(3),g(" ",(o=s.profile())!=null&&o.username?"@"+s.profile().username:""," "),a(3),g(" ",s.displayedBibliography()||"Sin biograf\xEDa"," "),a(),p((((d=s.profile())==null||d.bibliography==null?null:d.bibliography.length)??0)>500?16:-1),a(2),p(s.profile().country?18:-1),a(5),g(" ",Q(24,7,s.profile().created_at,"MMMM, yyyy")," ")}}function _e(i,t){if(i&1&&(n(0,"p",20),l(1),r()),i&2){let e=c(2);a(),V(e.errorMessage())}}function be(i,t){if(i&1){let e=w();n(0,"div",0)(1,"mat-icon",19),l(2,"error_outline"),r(),n(3,"p",3),l(4,"No se pudo cargar el perfil"),r(),m(5,_e,2,1,"p",20),n(6,"button",21),u("click",function(){v(e);let d=c();return h(d.loadFriendProfile())}),l(7," Reintentar "),r()()}if(i&2){let e=c();a(5),p(e.errorMessage()?5:-1)}}var E=class i{friendId;location=f(j);goBack(){this.location.back()}profile=_(null);loading=_(!0);errorMessage=_(null);showFullBibliography=_(!1);_supabaseClient=f(J);avatarUrl=L(()=>{let t=this.profile();return t&&t.avatarUrl||"/assets/images/defaultUser.png"});ngOnInit(){this.loadFriendProfile()}ngOnChanges(){this.loadFriendProfile()}displayedBibliography=L(()=>{let t=this.profile()?.bibliography??"";return t.length<=500||this.showFullBibliography()?t:t.slice(0,500)+"..."});toggleBibliography(){this.showFullBibliography.update(t=>!t)}onImageError(t){let e=t.target;e.src="/assets/images/defaultUser.png"}loadFriendProfile(){return N(this,null,function*(){try{this.loading.set(!0),this.errorMessage.set(null);let{data:t,error:e}=yield this._supabaseClient.from("profile").select("*").eq("id",this.friendId).maybeSingle();if(e)throw e;if(!t)throw new Error("No se encontr\xF3 el perfil del amigo.");this.profile.set(t)}catch(t){console.error("Error cargando perfil del amigo:",t),this.errorMessage.set(t instanceof Error?t.message:"Error desconocido al cargar el perfil.")}finally{this.loading.set(!1)}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-friend-info-card"]],inputs:{friendId:"friendId"},features:[I],decls:3,vars:3,consts:[[1,"flex","flex-col","items-center","justify-center","py-8"],[1,"flex","flex-col","gap-1","md:gap-5","p-4","md:p-8","bg-[#F0F4F9]","rounded-lg","shadow-lg","border-[0.5px]","border-[#757575]","text-center","justify-center","items-center","text-black"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-[#9811fb]"],[1,"text-gray-600","mt-4"],[1,"flex","w-full"],["mat-fab","","extended","",1,"",3,"click"],[1,"!text-lg"],["alt","Imagen de perfil","referrerpolicy","no-referrer","crossorigin","anonymous",1,"w-[110px]","h-[110px]","rounded-full","border-2","border-indigo-200","object-cover",3,"error","src"],[1,"flex","items-center","gap-3"],[1,"text-base","md:text-2xl","lg:text-xl","2xl:text-2xl","font-bold","text-black"],[1,"text-xs","md:text-base","text-[#757575]","font-normal"],[1,"flex","flex-col","items-center","gap-3","mb-2","md:mb-0"],[1,"text-sm","md:text-base","font-medium","text-[#757575]"],[1,"text-[#9811fb]","text-xs","font-semibold","hover:underline"],[1,"flex","content-between","items-center","justify-center","gap-4"],[1,"!text-[#9811fb]"],[1,"text-xs","font-normal","text-[#757575]","capitalize"],[1,"text-[#9811fb]","text-xs","font-semibold","hover:underline",3,"click"],[1,"text-xs","font-normal","text-[#757575]"],[1,"!text-red-500","!text-5xl"],[1,"text-sm","text-red-500","mt-2"],[1,"mt-4","px-4","py-2","bg-[#9811fb]","text-white","rounded-lg","hover:bg-[#7a0dd1]","transition",3,"click"]],template:function(e,o){e&1&&(m(0,ge,4,0,"div",0),m(1,xe,25,10,"div",1),m(2,be,8,1,"div",0)),e&2&&(p(o.loading()?0:-1),a(),p(!o.loading()&&o.profile()?1:-1),a(),p(!o.loading()&&!o.profile()?2:-1))},dependencies:[C,F,M,q,W,z],encapsulation:2})};var we=(i,t)=>t.id;function ye(i,t){if(i&1){let e=w();n(0,"button",8),u("click",function(){v(e);let d=c();return d.searchQuery="",h(d.onSearchChange())}),n(1,"mat-icon"),l(2,"close"),r()()}}function Ce(i,t){i&1&&(n(0,"div",7),x(1,"mat-spinner",9),r())}function Ie(i,t){if(i&1){let e=w();n(0,"app-card-review",14),u("goToReview",function(d){v(e);let s=c(2);return h(s.onGoToReview(d))}),r()}if(i&2){let e=t.$implicit,o=c(2);b("id",e.id)("title",e.title)("content",e.content)("posterPath",e.posterPath)("reviewerName",e.reviewerName)("directorName",e.directorName)("rating",e.rating)("createdAt",e.createdAt)("userId",e.userId)("currentUserId",o.currentUserId)("showImage",!0)("showGoToReview",!0)("likes",e.likes)("comments",e.comments)("liked",e.liked)}}function Se(i,t){i&1&&(n(0,"div",12)(1,"mat-icon",15),l(2,"rate_review"),r(),n(3,"p",16),l(4,"Este usuario no ha escrito ninguna rese\xF1a a\xFAn"),r()())}function Me(i,t){if(i&1&&(n(0,"div",12)(1,"mat-icon",15),l(2,"search_off"),r(),n(3,"p",16),l(4),r()()),i&2){let e=c(2);a(4),g('No se encontraron rese\xF1as con el t\xEDtulo "',e.searchQuery,'"')}}function Fe(i,t){i&1&&(n(0,"div",13),x(1,"mat-spinner",17),r())}function Ee(i,t){if(i&1&&(n(0,"div",10),k(1,Ie,1,15,"app-card-review",11,we),m(3,Se,5,0,"div",12),m(4,Me,5,1,"div",12),r(),m(5,Fe,2,0,"div",13)),i&2){let e=c();a(),D(e.filteredReviews),a(2),p(e.filteredReviews.length===0&&!e.searchQuery?3:-1),a(),p(e.filteredReviews.length===0&&e.searchQuery?4:-1),a(),p(e.isLoadingMore?5:-1)}}var T=class i{_reviewsService=f(se);_notificationsService=f(G);router=f(S);friendId;reviews=[];filteredReviews=[];isLoading=!1;isLoadingMore=!1;searchQuery="";currentUserId="";pagination={page:1,size:10,total:0,totalPages:0,hasNext:!1,hasPrevious:!1};ngOnInit(){this.getCurrentUserId(),this.loadFriendReviews(),this.setupScrollListener()}ngOnChanges(){this.pagination.page=1,this.reviews=[],this.filteredReviews=[],this.loadFriendReviews()}loadFriendReviews(t=!0){t&&(this.isLoading=!0);let e={page:this.pagination.page,size:this.pagination.size,sort:"created_at,desc"};this._reviewsService.getUserReviewsByIdWithPagination(this.friendId,e).subscribe({next:o=>{this.reviews=o.data.sort((d,s)=>new Date(s.createdAt).getTime()-new Date(d.createdAt).getTime()),this.pagination=P({},o.pagination),this.applySearch(),t&&(this.isLoading=!1)},error:o=>{console.error("Error al obtener reviews del amigo:",o),this._notificationsService.error("Error al cargar reviews del amigo"),t&&(this.isLoading=!1)}})}getCurrentUserId(){let t=localStorage.getItem("app_session");if(t)try{let e=JSON.parse(t);this.currentUserId=e.user?.id||""}catch(e){console.error("Error parsing session:",e)}}setupScrollListener(){let t=document.querySelector("main.main");t?t.addEventListener("scroll",()=>{this.checkScroll(t)}):window.addEventListener("scroll",()=>{this.checkScrollWindow()})}checkScroll(t){let e=t.scrollTop+t.clientHeight,o=t.scrollHeight;e/o*100>=50&&this.pagination.hasNext&&!this.isLoadingMore&&this.loadMoreReviews()}checkScrollWindow(){let t=window.pageYOffset+window.innerHeight,e=document.documentElement.scrollHeight;t/e*100>=50&&this.pagination.hasNext&&!this.isLoadingMore&&this.loadMoreReviews()}loadMoreReviews(){if(!this.pagination.hasNext||this.isLoadingMore)return;this.isLoadingMore=!0,this.pagination.page++;let t={page:this.pagination.page,size:this.pagination.size,sort:"created_at,desc"};this._reviewsService.getUserReviewsByIdWithPagination(this.friendId,t).subscribe({next:e=>{let o=new Set(this.reviews.map(s=>s.id)),d=e.data.filter(s=>!o.has(s.id));this.reviews=[...this.reviews,...d],this.reviews.sort((s,fe)=>new Date(fe.createdAt).getTime()-new Date(s.createdAt).getTime()),this.pagination=P({},e.pagination),this.applySearch(),this.isLoadingMore=!1},error:e=>{console.error("Error al cargar m\xE1s reviews:",e),this.isLoadingMore=!1,this.pagination.page--}})}onSearchChange(){this.applySearch()}applySearch(){if(!this.searchQuery.trim())this.filteredReviews=[...this.reviews];else{let t=this.searchQuery.toLowerCase().trim();this.filteredReviews=this.reviews.filter(e=>e.title.toLowerCase().includes(t))}}onGoToReview(t){this.router.navigate(["/home"],{queryParams:{reviewId:t}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-friend-library-tabs"]],inputs:{friendId:"friendId"},features:[I],decls:13,vars:3,consts:[[1,"bg-[#F0F4F9]","rounded-lg","shadow-lg","border-[0.5px]","border-[#757575]"],[1,"container","mx-auto","px-4","py-4","text-black"],[1,"text-2xl","font-bold","mb-6","text-center"],["appearance","outline",1,"w-full"],["matInput","","type","text","placeholder","Escribe el t\xEDtulo de la pel\xEDcula...",3,"ngModelChange","ngModel"],["matPrefix",""],["matSuffix","","mat-icon-button","",1,"text-gray-500"],[1,"flex","justify-center","items-center","py-12"],["matSuffix","","mat-icon-button","",1,"text-gray-500",3,"click"],["diameter","50"],[1,"grid","gap-6"],[3,"id","title","content","posterPath","reviewerName","directorName","rating","createdAt","userId","currentUserId","showImage","showGoToReview","likes","comments","liked"],[1,"text-center","py-12","text-gray-600"],[1,"flex","justify-center","items-center","py-6"],[3,"goToReview","id","title","content","posterPath","reviewerName","directorName","rating","createdAt","userId","currentUserId","showImage","showGoToReview","likes","comments","liked"],[1,"text-6xl","mb-4"],[1,"text-xl"],["diameter","40"]],template:function(e,o){e&1&&(n(0,"article",0)(1,"div",1)(2,"h2",2),l(3,"Rese\xF1as"),r(),n(4,"mat-form-field",3)(5,"mat-label"),l(6,"Buscar por t\xEDtulo"),r(),n(7,"input",4),U("ngModelChange",function(s){return O(o.searchQuery,s)||(o.searchQuery=s),s}),u("ngModelChange",function(){return o.onSearchChange()}),r(),n(8,"mat-icon",5),l(9,"search"),r(),m(10,ye,3,0,"button",6),r(),m(11,Ce,2,0,"div",7)(12,Ee,6,3),r()()),e&2&&(a(7),B("ngModel",o.searchQuery),a(3),p(o.searchQuery?10:-1),a(),p(o.isLoading?11:12))},dependencies:[C,ee,X,Z,$,F,M,le,ae,re,te,ie,ne,oe,K,Y,de],encapsulation:2})};function Te(i,t){if(i&1&&(n(0,"div",0)(1,"section",1),x(2,"app-friend-info-card",2),r(),n(3,"section",1),x(4,"app-friend-library-tabs",2),r()()),i&2){let e=c();a(2),b("friendId",e.userId()),a(2),b("friendId",e.userId())}}var pe=class i{route=f(H);router=f(S);userId=_(null);ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("userId");if(!e){this.router.navigate(["/home"]);return}this.userId.set(e)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-public-profile"]],decls:1,vars:1,consts:[[1,"flex","flex-col","gap-6","w-[90%]","justify-center","items-center","mx-auto","py-5"],[1,"relative","z-10","w-full"],[3,"friendId"]],template:function(e,o){e&1&&m(0,Te,5,2,"div",0),e&2&&p(o.userId()?0:-1)},dependencies:[C,E,T],encapsulation:2})};export{pe as PublicProfile};
