import{a as A}from"./chunk-D6LKXYUQ.js";import{b as V}from"./chunk-Z6PT2AXA.js";import{a as x}from"./chunk-F63DPOLD.js";import"./chunk-VN3CQEPZ.js";import{b as W,c as X}from"./chunk-LYMOFPMC.js";import{A as J,D as K,E as Q,e as G,g as w,j as D,k as R,o as q,q as B,r as O,t as j,v as H,w as U,x as z}from"./chunk-EK5XN74M.js";import{l as F,m as E,o as k}from"./chunk-J6OIAH2E.js";import"./chunk-E6SG4RJT.js";import{c as y,e as M}from"./chunk-NSQ4QIVB.js";import{a as Y}from"./chunk-T3ANTPHN.js";import"./chunk-VP7ZHMMA.js";import{b as I,c as L}from"./chunk-JNEX3YXP.js";import{l as N}from"./chunk-ZUAAQJ5J.js";import"./chunk-YUIT4C56.js";import"./chunk-HI5P6VLK.js";import{a as T}from"./chunk-AOTVPSR2.js";import{Fc as P,Ga as i,Pb as s,Qb as b,Sa as C,_ as d,fb as v,gb as m,hb as c,mb as u,nb as r,ob as o,pb as p,zb as h}from"./chunk-4XNWJBNU.js";import"./chunk-X5YLR3NI.js";import{i as _}from"./chunk-ODN5LVDJ.js";function $(a,t){a&1&&(r(0,"mat-error"),s(1,"La contrase\xF1a es requerida"),o())}function ee(a,t){a&1&&(r(0,"mat-error"),s(1,"La contrase\xF1a debe tener al menos 6 caracteres"),o())}function te(a,t){a&1&&(r(0,"mat-error"),s(1,"Confirma tu contrase\xF1a"),o())}function ie(a,t){a&1&&(r(0,"mat-error"),s(1,"Las contrase\xF1as no coinciden"),o())}function re(a,t){a&1&&p(0,"app-loader")}var Z=class a{form;hidePassword=!0;hideConfirmPassword=!0;isLoading=!1;_fb=d(j);_router=d(M);_route=d(y);_supabaseClient=d(T);_notificationsService=d(N);_tokenService=d(x);constructor(){this.form=this._fb.group({password:["",[w.required,w.minLength(6)]],confirmPassword:["",[w.required]]},{validators:this.passwordsMatchValidator})}ngOnInit(){return _(this,null,function*(){this._tokenService.clearSession();let{data:{session:t},error:n}=yield this._supabaseClient.auth.getSession();(n||!t)&&(console.error("\u274C Error obteniendo sesi\xF3n:",n),this._notificationsService.error("Link inv\xE1lido o expirado. Por favor solicita un nuevo correo."),this._router.navigate(["/auth/login"]))})}passwordsMatchValidator(t){let n=t.get("password")?.value,e=t.get("confirmPassword")?.value;return n===e?null:{passwordsMismatch:!0}}setPassword(){return _(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched();return}this.isLoading=!0;try{let{password:t}=this.form.value,{error:n}=yield this._supabaseClient.auth.updateUser({password:t});if(n)throw n;yield this._supabaseClient.auth.signOut(),this._tokenService.clearSession(),this._notificationsService.success("\xA1Contrase\xF1a establecida correctamente! Ahora puedes iniciar sesi\xF3n."),this._router.navigate(["/auth/login"])}catch(t){this._notificationsService.error(t.message||"Error al establecer la contrase\xF1a.")}finally{this.isLoading=!1}})}togglePasswordVisibility(){this.hidePassword=!this.hidePassword}toggleConfirmPasswordVisibility(){this.hideConfirmPassword=!this.hideConfirmPassword}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=C({type:a,selectors:[["app-set-password"]],decls:26,vars:16,consts:[[1,"flex","items-center","justify-center","min-h-screen","bg-gradient-to-br","from-purple-900","via-purple-800","to-indigo-900"],[3,"title"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"text-gray-300","text-sm","mb-6"],["appearance","outline",1,"w-full"],["matInput","","formControlName","password","placeholder","M\xEDnimo 6 caracteres",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword","placeholder","Repite tu contrase\xF1a",3,"type"],["mat-raised-button","","color","primary","type","submit",1,"w-full",3,"disabled"]],template:function(n,e){if(n&1&&(r(0,"section",0)(1,"app-auth-card",1)(2,"form",2),h("ngSubmit",function(){return e.setPassword()}),r(3,"p",3),s(4," Por favor establece una contrase\xF1a segura para tu cuenta. "),o(),r(5,"mat-form-field",4)(6,"mat-label"),s(7,"Nueva Contrase\xF1a"),o(),p(8,"input",5),r(9,"button",6),h("click",function(){return e.togglePasswordVisibility()}),r(10,"mat-icon"),s(11),o()(),m(12,$,2,0,"mat-error"),m(13,ee,2,0,"mat-error"),o(),r(14,"mat-form-field",4)(15,"mat-label"),s(16,"Confirmar Contrase\xF1a"),o(),p(17,"input",7),r(18,"button",6),h("click",function(){return e.toggleConfirmPasswordVisibility()}),r(19,"mat-icon"),s(20),o()(),m(21,te,2,0,"mat-error"),m(22,ie,2,0,"mat-error"),o(),r(23,"button",8),m(24,re,1,0,"app-loader"),s(25," Establecer Contrase\xF1a "),o()()()()),n&2){let l,g,f,S;i(),u("title","Establecer Contrase\xF1a"),i(),u("formGroup",e.form),i(6),u("type",e.hidePassword?"password":"text"),i(),v("aria-label","Hide password")("aria-pressed",e.hidePassword),i(2),b(e.hidePassword?"visibility_off":"visibility"),i(),c((l=e.form.get("password"))!=null&&l.hasError("required")&&((l=e.form.get("password"))!=null&&l.touched)?12:-1),i(),c((g=e.form.get("password"))!=null&&g.hasError("minlength")?13:-1),i(4),u("type",e.hideConfirmPassword?"password":"text"),i(),v("aria-label","Hide password")("aria-pressed",e.hideConfirmPassword),i(2),b(e.hideConfirmPassword?"visibility_off":"visibility"),i(),c((f=e.form.get("confirmPassword"))!=null&&f.hasError("required")&&((f=e.form.get("confirmPassword"))!=null&&f.touched)?21:-1),i(),c(e.form.hasError("passwordsMismatch")&&((S=e.form.get("confirmPassword"))!=null&&S.touched)?22:-1),i(),u("disabled",e.isLoading||e.form.invalid),i(),c(e.isLoading?24:-1)}},dependencies:[P,H,q,G,D,R,B,O,Q,K,U,z,J,X,W,k,E,F,L,I,V,Y,A],styles:["[_nghost-%COMP%]{display:block}  .mat-mdc-form-field{width:100%}  .mat-mdc-text-field-wrapper{background-color:#ffffff0d}  .mat-mdc-form-field-focus-overlay{background-color:#ffffff0d}  .mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:#ffffff0d}"]})};export{Z as SetPassword};
