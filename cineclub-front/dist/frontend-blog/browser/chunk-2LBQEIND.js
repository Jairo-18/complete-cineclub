import{a as _}from"./chunk-D6LKXYUQ.js";import"./chunk-Z6PT2AXA.js";import{a as C}from"./chunk-F63DPOLD.js";import"./chunk-E6SG4RJT.js";import{e as n}from"./chunk-NSQ4QIVB.js";import{a as b}from"./chunk-VP7ZHMMA.js";import{l as w}from"./chunk-ZUAAQJ5J.js";import"./chunk-YUIT4C56.js";import{a as c}from"./chunk-HI5P6VLK.js";import"./chunk-AOTVPSR2.js";import{Hc as k,Sa as v,V as f,_ as o,nb as y,ob as g,pb as S,xa as h}from"./chunk-4XNWJBNU.js";import"./chunk-X5YLR3NI.js";import{a as m,b as u,i as a}from"./chunk-ODN5LVDJ.js";var l=class e{_tokenService=o(C);_router=o(n);_notificationsService=o(w);handleCallback(){return a(this,null,function*(){try{this._tokenService.clearSession();let{data:r,error:t}=yield c.auth.exchangeCodeForSession(window.location.href);if(t)throw console.error("\u274C [Callback] Error en exchangeCodeForSession:",t),t;if(!r.session||!r.user)throw console.error("\u274C [Callback] No se obtuvo sesi\xF3n o usuario"),new Error("No se pudo obtener sesi\xF3n.");let{data:i,error:d}=yield c.from("profile").select(`
          id,
          roleTypeId,
          roleType:roleType!fk_profile_roletype (
            id,
            code,
            name
          )
        `).eq("id",r.user.id).single();if(d)throw console.error("\u274C Error al obtener perfil:",d),d;let A=u(m({},i),{roleType:Array.isArray(i.roleType)?i.roleType[0]:i.roleType});this._tokenService.saveSession(r.session.access_token,r.session.refresh_token,A),this._notificationsService.success("\xA1Cuenta verificada exitosamente! Bienvenido."),yield this._router.navigateByUrl("/")}catch(r){console.error("\u274C Error en handleCallback:",r),yield c.auth.signOut(),this._tokenService.clearSession(),this._notificationsService.info("Tu cuenta ha sido verificada exitosamente. Por favor, inicia sesi\xF3n con tus credenciales."),yield this._router.navigateByUrl("/auth/login")}})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=f({token:e,factory:e.\u0275fac,providedIn:"root"})};var p=class e{_authCallbackService=o(l);_router=o(n);_platformId=o(h);ngOnInit(){return a(this,null,function*(){if(k(this._platformId))try{yield this._authCallbackService.handleCallback()}catch(r){console.error("\u274C Error durante el callback:",r),yield this._router.navigate(["/auth/login"])}})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=v({type:e,selectors:[["app-auth-call-back"]],decls:3,vars:0,consts:[[1,"flex","items-center","justify-center","min-h-screen","bg-[#121212]"],[1,"text-center"]],template:function(t,i){t&1&&(y(0,"div",0)(1,"div",1),S(2,"app-loader"),g()())},dependencies:[_],encapsulation:2})};var s=()=>a(null,null,function*(){let e=o(b),r=o(n);yield e.waitForAuthReady();let{data:t}=yield e.getSession();return t.session?r.createUrlTree(["/"]):!0});var Z=[{path:"",children:[{path:"login",loadComponent:()=>import("./chunk-UYXSU7XI.js").then(e=>e.Login),canActivate:[s]},{path:"register",loadComponent:()=>import("./chunk-4V6ZFSNF.js").then(e=>e.Register),canActivate:[s]},{path:"recover-password",loadComponent:()=>import("./chunk-JKQKKBMP.js").then(e=>e.RecoverPassword),canActivate:[s]},{path:"set-password",loadComponent:()=>import("./chunk-IFHZHTOW.js").then(e=>e.SetPassword)},{path:"callback",component:p},{path:"send-email",loadComponent:()=>import("./chunk-QUF6OO6E.js").then(e=>e.SendEmail),canActivate:[s]}]}];export{Z as authRoutes};
