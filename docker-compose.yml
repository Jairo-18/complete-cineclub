# Docker Compose para desarrollo local - Frontend + Backend
# Uso: docker-compose up --build
# Nota: MongoDB, Redis y Neo4j usan los servicios cloud del archivo .env

services:
  # ==================== BACKEND (Spring Boot) ====================
  backend:
    build:
      context: ./cineclub-back
      dockerfile: Dockerfile.local
    container_name: cineclub_backend
    restart: unless-stopped
    env_file:
      - ./cineclub-back/.env
    environment:
      # Sobreescribir CORS para permitir frontend local
      CORS_ALLOWED_ORIGINS: http://localhost:4200
      CORS_ALLOW_CREDENTIALS: 'true'
    ports:
      - '8080:8080'
    volumes:
      - ./cineclub-back:/app
      - backend_m2_cache:/root/.m2
    command: ['./mvnw', 'spring-boot:run']
    networks:
      - cineclub_network

  # ==================== FRONTEND (Angular) ====================
  frontend:
    build:
      context: ./cineclub-front
      dockerfile: Dockerfile.dev
    container_name: cineclub_frontend
    restart: unless-stopped
    depends_on:
      - backend
    environment:
      # Variables de entorno para Angular (si las necesita)
      NODE_ENV: development
    ports:
      - '4200:4200'
    volumes:
      - ./cineclub-front:/app
      - frontend_node_modules:/app/node_modules # Volumen nombrado para persistir dependencias
    networks:
      - cineclub_network

# ==================== VOLUMES ====================
volumes:
  backend_m2_cache:
  frontend_node_modules:

# ==================== NETWORKS ====================
networks:
  cineclub_network:
    driver: bridge
