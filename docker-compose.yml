# Docker Compose para desarrollo local - Frontend + Backend
# Uso: docker-compose up --build
# Nota: MongoDB, Redis y Neo4j usan los servicios cloud del archivo .env

services:
  # ==================== BACKEND (Spring Boot) ====================
  backend:
    build:
      context: ./cineclub-back
      dockerfile: Dockerfile
    container_name: cineclub_backend
    restart: unless-stopped
    env_file:
      - ./cineclub-back/.env
    environment:
      # Sobreescribir CORS para permitir frontend local
      CORS_ALLOWED_ORIGINS: http://localhost:4200
      CORS_ALLOW_CREDENTIALS: 'true'
    ports:
      - '8080:8080'
    # No host bind mounts - use image contents to avoid host persistence during build
    # Use the image's default ENTRYPOINT (built JAR) to avoid running mvnw at runtime
    networks:
      - cineclub_network

  # ==================== FRONTEND (Angular) ====================
  frontend:
    build:
      context: ./cineclub-front
      dockerfile: Dockerfile.dev
    container_name: cineclub_frontend
    restart: unless-stopped
    depends_on:
      - backend
    environment:
      # Variables de entorno para Angular (si las necesita)
      NODE_ENV: development
    ports:
      - '4200:4200'
    # No host bind mounts - use image contents to avoid host persistence during build
    networks:
      - cineclub_network

# ==================== VOLUMES ====================
## Removed project-specific volumes to avoid persistence during builds

# ==================== NETWORKS ====================
networks:
  cineclub_network:
    driver: bridge
